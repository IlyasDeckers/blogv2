<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Introduction This tutorial will show how to install the Percona XtraDB Cluster on three Ubuntu 16.04 LTS servers, using the packages from the official Percona repositories. After this tutorial you should be able to install, configure and secure a high available MySQL cluster.\nPrerequisites To follow this tutorial you need 3 machines running Ubuntu 16.04. All machines need to be reachable over SSH and they need to be in the same network.\n"><title>Build a High Available MySQL Cluster with Percona XtraDB and Ubuntu 16.04</title>
<link rel=canonical href=https://ilyasdeckers.ody.dev/p/building-high-available-mysql-cluster-with-percona-xtradb/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="Build a High Available MySQL Cluster with Percona XtraDB and Ubuntu 16.04"><meta property='og:description' content="Introduction This tutorial will show how to install the Percona XtraDB Cluster on three Ubuntu 16.04 LTS servers, using the packages from the official Percona repositories. After this tutorial you should be able to install, configure and secure a high available MySQL cluster.\nPrerequisites To follow this tutorial you need 3 machines running Ubuntu 16.04. All machines need to be reachable over SSH and they need to be in the same network.\n"><meta property='og:url' content='https://ilyasdeckers.ody.dev/p/building-high-available-mysql-cluster-with-percona-xtradb/'><meta property='og:site_name' content='Ilyas Deckers Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='MySQL'><meta property='article:tag' content='Percona XtraDB'><meta property='article:tag' content='Linux'><meta property='article:published_time' content='2017-03-14T00:00:00+00:00'><meta property='article:modified_time' content='2017-03-14T00:00:00+00:00'><meta name=twitter:title content="Build a High Available MySQL Cluster with Percona XtraDB and Ubuntu 16.04"><meta name=twitter:description content="Introduction This tutorial will show how to install the Percona XtraDB Cluster on three Ubuntu 16.04 LTS servers, using the packages from the official Percona repositories. After this tutorial you should be able to install, configure and secure a high available MySQL cluster.\nPrerequisites To follow this tutorial you need 3 machines running Ubuntu 16.04. All machines need to be reachable over SSH and they need to be in the same network.\n"><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu_a04bd0a3db431516.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üç•</span></figure><div class=site-meta><h1 class=site-name><a href=/>Ilyas Deckers Blog</a></h1><h2 class=site-description>Software engineer - PHP, Swoole, Docker, MySQL, Azure, Redis, Devops, RabbitMQ, GoLang and a bit of Rust.</h2></div></header><ol class=menu-social><li><a href=https://bsky.app/profile/ilyasdeckers.bsky.social target=_blank title=Bluesky rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li><li><a href=https://github.com/IlyasDeckers target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#introduction>Introduction</a></li><li><a href=#prerequisites>Prerequisites</a><ol><li><a href=#configuring-the-repositories>Configuring the repositories</a></li><li><a href=#configure-apparmor--selinux>Configure Apparmor & SElinux</a></li></ol></li><li><a href=#configure-your-firewall>Configure your firewall</a></li><li><a href=#configure-the-bootstrap-node>Configure the bootstrap node</a></li><li><a href=#configure-the-two-other-nodes>Configure the two other nodes</a><ol><li><a href=#conclusion>Conclusion</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/mysql/>MySQL</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/building-high-available-mysql-cluster-with-percona-xtradb/>Build a High Available MySQL Cluster with Percona XtraDB and Ubuntu 16.04</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Mar 14, 2017</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>5 minute read</time></div></footer></div></header><section class=article-content><h2 id=introduction>Introduction</h2><p>This tutorial will show how to install the <em>Percona XtraDB Cluster</em> on three <em>Ubuntu</em> 16.04 LTS servers, using the packages from the official Percona repositories. After this tutorial you should be able to install, configure and secure a high available MySQL cluster.</p><h2 id=prerequisites>Prerequisites</h2><p>To follow this tutorial you need 3 machines running Ubuntu 16.04. All machines need to be reachable over SSH and they need to be in the same network.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>node #1
</span></span><span class=line><span class=cl>hostname: mysql01
</span></span><span class=line><span class=cl>IP: 10.100.0.200
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>node #2
</span></span><span class=line><span class=cl>hostname: mysql02
</span></span><span class=line><span class=cl>IP:10.100.0.201
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>node #3 
</span></span><span class=line><span class=cl>hostname: mysql03 
</span></span><span class=line><span class=cl>IP:10.100.0.202
</span></span></code></pre></td></tr></table></div></div><h3 id=configuring-the-repositories>Configuring the repositories</h3><p>To install Percona XtraDB you will have to add the appropriate repositories to your servers. Run the following commands on the three nodes.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>wget https://repo.percona.com/apt/percona-release_0.1-4.<span class=k>$(</span>lsb_release -sc<span class=k>)</span>_all.deb
</span></span><span class=line><span class=cl>sudo dpkg -i percona-release_0.1-4.<span class=k>$(</span>lsb_release -sc<span class=k>)</span>_all.deb
</span></span><span class=line><span class=cl>sudo apt-get update
</span></span><span class=line><span class=cl>sudo apt-get install percona-xtradb-cluster-57
</span></span></code></pre></td></tr></table></div></div><h3 id=configure-apparmor--selinux>Configure Apparmor & SElinux</h3><p>In order to successfully start Percona XtraDB, it is advised to disable SElinux. When SElinux is enabled the communication between nodes does not work and the nodes won&rsquo;t be able to join the cluster successfully. By default SElinux is not enabled in Ubuntu, if you have installed it previously there are some options for disabling it. To test if SElinux is enabled on your system run the following command.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>selinuxenabled <span class=o>&amp;&amp;</span> <span class=nb>echo</span> enabled <span class=o>||</span> <span class=nb>echo</span> disabled
</span></span></code></pre></td></tr></table></div></div><p>If SElinux is enabled you can completely remove it from your system by uninstalling it</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo apt-get remove selinux* --purge -y
</span></span></code></pre></td></tr></table></div></div><p>Or you can disable it by editing the config file for SElinux.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>SELINUX</span><span class=o>=</span>disabled
</span></span></code></pre></td></tr></table></div></div><p>Percona doesn‚Äôt provide any AppArmor profile for PXC, but it seems that on this server (Ubuntu TLS), a previous version of MySQL was installed and then removed but the AppArmor profile was still present. So if you use apparmor (or if you don‚Äôt know) and you want to check is there is a profile for mysql, you can run the following command :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>apparmor_status
</span></span></code></pre></td></tr></table></div></div><p>If a mysql profile is available you can disable it like this.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo ln -s /etc/apparmor.d/usr.sbin.mysqld /etc/apparmor.d/disable/
</span></span><span class=line><span class=cl>sudo apparmor_parser -R /etc/apparmor.d/usr.sbin.mysqld
</span></span></code></pre></td></tr></table></div></div><p>If SElinux is enabled you can completely remove it from your system by uninstalling it</p><blockquote><p>Remember to check all your nodes, it prevents a lot of issues later on.</p></blockquote><h2 id=configure-your-firewall>Configure your firewall</h2><p>Percona XtraDB uses some ports asside from the standard 3306. You need to open these ports on your firewall for the cluster to function well.</p><p><strong>MySQL:</strong> 3306<br><strong>Cluster Communication:</strong> 4567<br><strong>SST:</strong> 4568</p><p>The main cluster communication happens over port 4567. You can change this by specifying this option.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>wsrep_provider_options=&#34;gmcast.listen_addr=tcp://0.0.0.0:4010;&#34; 
</span></span></code></pre></td></tr></table></div></div><h2 id=configure-the-bootstrap-node>Configure the bootstrap node</h2><p>Go to your first node and open /etc/mysql/my.cnf and copy the following configuration at the end of the file and change the IP&rsquo;s on line 2 and 6 to your configuration.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>wsrep_provider</span><span class=o>=</span>/usr/lib/libgalera_smm.so
</span></span><span class=line><span class=cl><span class=nv>wsrep_cluster_address</span><span class=o>=</span>gcomm://10.100.0.200,10.100.0.201,10.100.0.203 <span class=c1># Change the IP&#39;s to your IP&#39;s (ip1,ip2,ip3) </span>
</span></span><span class=line><span class=cl><span class=nv>binlog_format</span><span class=o>=</span>ROW
</span></span><span class=line><span class=cl><span class=nv>default_storage_engine</span><span class=o>=</span>InnoDB
</span></span><span class=line><span class=cl><span class=nv>innodb_autoinc_lock_mode</span><span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl>address <span class=nv>wsrep_node_address</span><span class=o>=</span>10.100.0.200 <span class=c1># The IP of the node that you are configuring</span>
</span></span><span class=line><span class=cl><span class=nv>wsrep_sst_method</span><span class=o>=</span>xtrabackup-v2 
</span></span><span class=line><span class=cl><span class=nv>wsrep_cluster_name</span><span class=o>=</span>my_mysql_cluster 
</span></span><span class=line><span class=cl><span class=nv>wsrep_sst_auth</span><span class=o>=</span><span class=s2>&#34;username:password&#34;</span> <span class=c1># A username and password for SST that we will configure later</span>
</span></span></code></pre></td></tr></table></div></div><p>The first node is ready to be started. Execute the following command to bootsrap the cluster.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>/etc/init.d/mysql bootstrap-pxc
</span></span></code></pre></td></tr></table></div></div><p>Now we have to check if the first node has started successfully.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mysql -u root -p 
</span></span><span class=line><span class=cl>mysql &gt; SHOW STATUS LIKE <span class=s1>&#39;wsrep%&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>+----------------------------+--------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Variable_name              <span class=p>|</span> Value                                <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------------------------+--------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_local_state_uuid     <span class=p>|</span> b598af3e-ace3-11e2-0800-3e90eb9cd5d3 <span class=p>|</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_local_state          <span class=p>|</span> <span class=m>4</span>                                    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_local_state_comment  <span class=p>|</span> Synced                               <span class=p>|</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_cluster_size         <span class=p>|</span> <span class=m>1</span>                                    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_cluster_status       <span class=p>|</span> Primary                              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_connected            <span class=p>|</span> ON                                   <span class=p>|</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_ready                <span class=p>|</span> ON                                   <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------------------------+--------------------------------------+
</span></span><span class=line><span class=cl><span class=m>60</span> rows in <span class=nb>set</span> <span class=o>(</span>0.01 sec<span class=o>)</span> 
</span></span></code></pre></td></tr></table></div></div><p>As you can see the first node started successfully and it is ready to accept other nodes to join the cluster. Now we have to configure a user to make use of State Snapshot Transfer. Change the username and password to the values you chose for wsrep_sst_auth in /etc/mysql/my.conf.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mysql&gt; CREATE USER <span class=s1>&#39;username&#39;</span>@<span class=s1>&#39;localhost&#39;</span> IDENTIFIED BY <span class=s1>&#39;password&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>mysql&gt; GRANT PROCESS, RELOAD, LOCK TABLES, REPLICATION CLIENT ON <span class=se>\*</span>.<span class=se>\*</span> TO <span class=s1>&#39;username&#39;</span>@<span class=s1>&#39;password&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>mysql&gt; FLUSH PRIVILEGES<span class=p>;</span> 
</span></span></code></pre></td></tr></table></div></div><blockquote><p>State Snapshot Transfer (SST) is a full data copy from one node (donor) to the joining node (joiner). It‚Äôs used when a new node joins the cluster. In order to be synchronized with the cluster, the new node has to receive data from a node that is already part of the cluster.</p></blockquote><h2 id=configure-the-two-other-nodes>Configure the two other nodes</h2><p>Edit /etc/mysql/my.cnf on the two other nodes. Remember to change the IP of the host on line 6.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nv>wsrep_provider</span><span class=o>=</span>/usr/lib/libgalera_smm.so
</span></span><span class=line><span class=cl><span class=nv>wsrep_cluster_address</span><span class=o>=</span>gcomm://10.100.0.200,10.100.0.201,10.100.0.203 <span class=c1># Change the IP&#39;s to your IP&#39;s (ip1,ip2,ip3) </span>
</span></span><span class=line><span class=cl>binlog<span class=se>\_</span>format<span class=o>=</span>ROW
</span></span><span class=line><span class=cl><span class=nv>default_storage_engine</span><span class=o>=</span>InnoDB
</span></span><span class=line><span class=cl><span class=nv>innodb_autoinc_lock_mode</span><span class=o>=</span><span class=m>2</span>
</span></span><span class=line><span class=cl>address wsrep<span class=se>\_</span>node_address<span class=o>=</span>10.100.0.200 <span class=c1># The IP of the node that you are configuring</span>
</span></span><span class=line><span class=cl><span class=nv>wsrep_sst_method</span><span class=o>=</span>xtrabackup-v2 
</span></span><span class=line><span class=cl><span class=nv>wsrep_cluster_name</span><span class=o>=</span>my_mysql_cluster 
</span></span><span class=line><span class=cl><span class=nv>wsrep_sst_auth</span><span class=o>=</span><span class=s2>&#34;username:password&#34;</span> <span class=c1># The username and password for SST</span>
</span></span></code></pre></td></tr></table></div></div><p>Then start MySQL on the nodes.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo service mysql start
</span></span></code></pre></td></tr></table></div></div><p>If everything went right, you can check the cluster status to check if all nodes are connected and the cluster is in a good state.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo mysql -u root -p 
</span></span><span class=line><span class=cl>mysql&gt; SHOW STATUS LIKE <span class=s1>&#39;wsrep%&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>+----------------------------+--------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> Variable_name              <span class=p>|</span> Value                                <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------------------------+--------------------------------------+
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_local_state_uuid     <span class=p>|</span> g4fd322e-whe3-11e2-0255<span class=se>\3</span>e90eb9cd5d3 <span class=p>|</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_local_state          <span class=p>|</span> <span class=m>4</span>                                    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_local_state_comment  <span class=p>|</span> Synced                               <span class=p>|</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_cluster_size         <span class=p>|</span> <span class=m>3</span>                                    <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_cluster_status       <span class=p>|</span> Primary                              <span class=p>|</span>
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_connected            <span class=p>|</span> ON                                   <span class=p>|</span>
</span></span><span class=line><span class=cl>...
</span></span><span class=line><span class=cl><span class=p>|</span> wsrep_ready                <span class=p>|</span> ON                                   <span class=p>|</span>
</span></span><span class=line><span class=cl>+----------------------------+--------------------------------------+
</span></span><span class=line><span class=cl><span class=m>40</span> rows in <span class=nb>set</span> <span class=o>(</span>0.01 sec<span class=o>)</span> 
</span></span></code></pre></td></tr></table></div></div><h3 id=conclusion>Conclusion</h3><p>Setting up a Percona XtraDB cluster is relatively easy. There are however some things that could go wrong. 90% of the time it has something to do with SElinux. A whole other beast is when your cluster dies, there are a lot of scenario&rsquo;s that could break the cluster. I will get more in depth in a later article.</p><blockquote><p>TIP: In case of any errors look for the file /var/lib/mysql/mysqlxx.err this file has saved me in a lot of situations when troubleshooting MySQL.</p></blockquote></section><footer class=article-footer><section class=article-tags><a href=/tags/mysql/>MySQL</a>
<a href=/tags/percona-xtradb/>Percona XtraDB</a>
<a href=/tags/linux/>Linux</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Mar 14, 2017 00:00 UTC</span></section></footer></article><footer class=site-footer><section class=copyright>&copy;
2020 -
2025 Ilyas Deckers Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>